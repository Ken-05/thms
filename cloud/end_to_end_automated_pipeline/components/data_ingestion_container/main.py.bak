import os
from google.cloud import aiplatform

# Trigger the pipeline using the Vertex AI SDK.

# Set environment variables or hardcode here
PROJECT_ID = os.getenv("GCP_PROJECT_ID", "tractor-health-monitoring")
REGION = os.getenv("GCP_REGION", "us-central1")
PIPELINE_JSON_PATH = "cloud/pipeline/end_to_end_automated_pipeline.json"
PIPELINE_ROOT = "gs://tractor-health-monitoring-bucket/pipeline_root"
DISPLAY_NAME = "tractor-health-monitoring-pipeline"

def run_pipeline():
    aiplatform.init(project=PROJECT_ID, location=REGION, staging_bucket=f"gs://tractor-health-monitoring-bucket",)

    job = aiplatform.PipelineJob(
        display_name=DISPLAY_NAME,
        template_path=PIPELINE_JSON_PATH,
        pipeline_root=PIPELINE_ROOT,
        enable_caching=True,
    )

    job.run(sync=True)  # sync=True waits for the job to finish

if __name__ == "__main__":
    run_pipeline()